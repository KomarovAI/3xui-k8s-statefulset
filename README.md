# 3X-UI VPN Panel - Kubernetes Deployment

## üö® –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å CI/CD: –¢–æ–ª—å–∫–æ —Ä—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫

**–í–Ω–∏–º–∞–Ω–∏–µ!** –í—Å–µ workflows GitHub Actions –≤ —ç—Ç–æ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è **—Ç–æ–ª—å–∫–æ –≤—Ä—É—á–Ω—É—é** (—á–µ—Ä–µ–∑ Actions ‚Üí Run workflow –ª–∏–±–æ —á–µ—Ä–µ–∑ GitHub CLI). –≠—Ç–æ –∑–∞—â–∏—â–∞–µ—Ç production –∏ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∏–ª–∏ —Å–ª—É—á–∞–π–Ω—ã–µ –¥–µ–ø–ª–æ–∏. –°–º. [docs/SECURITY.md](docs/SECURITY.md).

## üíæ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã –≤ GitHub

**–ù–æ–≤–æ–µ!** –ë—ç–∫–∞–ø—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥—É–±–ª–∏—Ä—É—é—Ç—Å—è –≤ GitHub (–≤–µ—Ç–∫–∞ `backups`) –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 03:00.

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

- ‚úÖ **–í–Ω–µ—à–Ω–µ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ** ‚Äî –∑–∞—â–∏—Ç–∞ –æ—Ç –ø–æ—Ç–µ—Ä–∏ PV/PVC
- ‚úÖ **Git-–≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Äî –∫–∞–∂–¥—ã–π –±—ç–∫–∞–ø –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º commit
- ‚úÖ **–õ–µ–≥–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ** ‚Äî `git clone -b backups`
- ‚úÖ **–•—Ä–∞–Ω–µ–Ω–∏–µ 30 –±—ç–∫–∞–ø–æ–≤** –≤ GitHub + 7 –¥–Ω–µ–π –≤ PVC

### –ë—ã—Å—Ç—Ä–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

```bash
# 1. –°–æ–∑–¥–∞—Ç—å GitHub PAT: https://github.com/settings/tokens
# Permissions: repo (–ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø)

# 2. –°–æ–∑–¥–∞—Ç—å Secret
kubectl create secret generic github-backup-secret \
  --from-literal=token='ghp_YOUR_TOKEN' \
  -n xui-vpn

# 3. –ü—Ä–∏–º–µ–Ω–∏—Ç—å CronJob
kubectl apply -f manifests/cronjob-backup.yaml

# 4. –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—É—Å–∫
kubectl create job --from=cronjob/xui-selfbackup manual-backup-test -n xui-vpn
```

**–ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è**: [docs/BACKUP_TO_GITHUB.md](docs/BACKUP_TO_GITHUB.md)
**–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ encryption**: [docs/ETCD_ENCRYPTION.md](docs/ETCD_ENCRYPTION.md)

**–ü—Ä–æ—Å–º–æ—Ç—Ä –±—ç–∫–∞–ø–æ–≤**: https://github.com/KomarovAI/3xui-k8s-statefulset/tree/backups

---

## üîí SSL-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã —á–µ—Ä–µ–∑ Let's Encrypt (Traefik)

### –ë—ã—Å—Ç—Ä–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ SSL (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç)

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ SSL:
chmod +x deploy-ssl-setup.sh
./deploy-ssl-setup.sh
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–∫—Ä–∏–ø—Ç:**
1. ‚úÖ –°–æ–∑–¥–∞—ë—Ç namespace `traefik` (–µ—Å–ª–∏ –Ω–µ—Ç)
2. ‚úÖ –î–µ–ø–ª–æ–∏—Ç Kubernetes Secret —Å email –¥–ª—è Let's Encrypt (`artur.komarovv@gmail.com`)
3. ‚úÖ –°–æ–∑–¥–∞—ë—Ç PVC –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ (`traefik-acme`)
4. ‚úÖ –ü–∞—Ç—á–∏—Ç Traefik Deployment –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –≤—ã–¥–∞—á–∏ SSL-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤

**–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞:**
- –í—Å–µ IngressRoute —Å `tls.certResolver: letsencrypt` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∞—Ç –≤–∞–ª–∏–¥–Ω—ã–µ SSL-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
- –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ PVC –∏ –Ω–µ —Ç–µ—Ä—è—é—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ
- Email –±–µ—Ä—ë—Ç—Å—è –∏–∑ Secret (–Ω–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –∏—Å—Ö–æ–¥–Ω–æ–º –∫–æ–¥–µ)

### –†—É—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∫–∞–∂–¥—ã–π —à–∞–≥ –≤—Ä—É—á–Ω—É—é:

```bash
# 1. –°–æ–∑–¥–∞—Ç—å namespace traefik
kubectl create namespace traefik --dry-run=client -o yaml | kubectl apply -f -

# 2. –î–µ–ø–ª–æ–π email secret
kubectl apply -f manifests/traefik/letsencrypt-email-secret.yaml

# 3. –°–æ–∑–¥–∞—Ç—å PVC –¥–ª—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
kubectl apply -f manifests/traefik/traefik-config.yaml

# 4. –ü–∞—Ç—á Traefik (—Å–º. –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –≤ manifests/traefik/traefik-config.yaml)
```

**–ü–æ–¥—Ä–æ–±–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –ø–∞—Ç—á—É Traefik**: —Å–º. –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ `manifests/traefik/traefik-config.yaml`

---

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Traefik + HTTPS (–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ SSL-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã)

–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Ç–µ–ø–µ—Ä—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –≤—ã–¥–∞—á—É DNS –∏ SSL-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤** —á–µ—Ä–µ–∑ Traefik:

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π DNS** —á–µ—Ä–µ–∑ nip.io (–Ω–µ –Ω—É–∂–Ω–æ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –¥–æ–º–µ–Ω!)
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ HTTPS-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã** –æ—Ç Let's Encrypt
- ‚úÖ **–†–µ–¥–∏—Ä–µ–∫—Ç HTTP ‚Üí HTTPS** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- ‚úÖ **–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å** ‚Äî –º–æ–∂–Ω–æ –ø—Ä–∏–º–µ–Ω—è—Ç—å –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ
- ‚úÖ **–ù—É–∂–Ω—ã —Ç–æ–ª—å–∫–æ –ø–æ—Ä—Ç—ã 80 –∏ 443** (–¥–ª—è Traefik)

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
–ò–Ω—Ç–µ—Ä–Ω–µ—Ç
   ‚Üì
DNS: xui.${SERVER_IP}.nip.io ‚Üí ${SERVER_IP}
   ‚Üì
Traefik (–ø–æ—Ä—Ç—ã 80/443)
   ‚Üì Let's Encrypt SSL
IngressRoute ‚Üí 3X-UI Service (–ø–æ—Ä—Ç 2053)
   ‚Üì
3X-UI Pod
```
