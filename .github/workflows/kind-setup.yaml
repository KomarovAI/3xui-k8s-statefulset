name: ðŸŽ¯ Setup KIND & Deploy
on:
  push:
    branches:
      - main
jobs:
  setup-kind:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Save KIND cluster config
        run: |
          cat <<EOF > kind-config.yaml
          kind: Cluster
          apiVersion: kind.x-k8s.io/v1alpha4
          nodes:
            - role: control-plane
              extraMounts:
                - hostPath: /tmp/k8s-test-pv
                  containerPath: /tmp/hostpath-provisioner
            - role: worker
          EOF
      - name: Create kind cluster
        uses: helm/kind-action@v1
        with:
          cluster_name: test-cluster
          version: v0.20.0
          config: kind-config.yaml
          wait: 60s
          verbosity: 0
          kubectl_version: v1.31.4
