# Kubernetes EncryptionConfiguration for etcd at-rest encryption
# НЕ КОММИТИТЬ РЕАЛЬНЫЙ KEY!
# Этот файл - только пример. Генерируйте свой 32-байтный ключ:
# head -c 32 /dev/urandom | base64

apiVersion: apiserver.config.k8s.io/v1
kind: EncryptionConfiguration
resources:
  - resources:
      - secrets
      - configmaps  # Опционально: шифровать ConfigMaps
    providers:
      # Используем aescbc для шифрования
      - aescbc:
          keys:
            - name: key1
              secret: <BASE64_ENCODED_32_BYTE_KEY>  # ЗАМЕНИТЬ!
      # Fallback на identity (незашифрованные данные)
      # Необходимо для постепенной миграции
      - identity: {}

---
# Пример использования KMS provider (рекомендуется для production)
apiVersion: apiserver.config.k8s.io/v1
kind: EncryptionConfiguration
resources:
  - resources:
      - secrets
    providers:
      # AWS KMS integration
      - kms:
          name: aws-encryption-provider
          endpoint: unix:///var/run/kmsplugin/socket.sock
          cachesize: 1000
          timeout: 3s
      - identity: {}
