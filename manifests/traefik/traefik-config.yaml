# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Traefik –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –≤—ã–¥–∞—á–∏ SSL-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
# 
# üöÄ PRODUCTION-READY: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Kubernetes Secret –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è email
#
# –®–ê–ì–ò –ü–†–ò–ú–ï–ù–ï–ù–ò–Ø:
#
# 1. –°–æ–∑–¥–∞—Ç—å Secret —Å email (—É–∂–µ –≤ —Ä–µ–ø–æ):
#    kubectl apply -f manifests/traefik/letsencrypt-email-secret.yaml
#
# 2. –°–æ–∑–¥–∞—Ç—å PVC –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤:
#    kubectl apply -f manifests/traefik/traefik-config.yaml
#
# 3. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –ø–∞—Ç—á –∫ Traefik Deployment (–ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è Secret):
#
# kubectl patch deployment traefik -n traefik --type=json -p='[
#   {
#     "op": "add",
#     "path": "/spec/template/spec/containers/0/env/-",
#     "value": {
#       "name": "LETSENCRYPT_EMAIL",
#       "valueFrom": {
#         "secretKeyRef": {
#           "name": "letsencrypt-email",
#           "key": "email"
#         }
#       }
#     }
#   },
#   {
#     "op": "add",
#     "path": "/spec/template/spec/containers/0/args/-",
#     "value": "--certificatesresolvers.letsencrypt.acme.email=$(LETSENCRYPT_EMAIL)"
#   },
#   {
#     "op": "add",
#     "path": "/spec/template/spec/containers/0/args/-",
#     "value": "--certificatesresolvers.letsencrypt.acme.storage=/data/acme.json"
#   },
#   {
#     "op": "add",
#     "path": "/spec/template/spec/containers/0/args/-",
#     "value": "--certificatesresolvers.letsencrypt.acme.httpchallenge.entrypoint=web"
#   },
#   {
#     "op": "add",
#     "path": "/spec/template/spec/containers/0/volumeMounts/-",
#     "value": {
#       "name": "acme-storage",
#       "mountPath": "/data"
#     }
#   },
#   {
#     "op": "add",
#     "path": "/spec/template/spec/volumes/-",
#     "value": {
#       "name": "acme-storage",
#       "persistentVolumeClaim": {
#         "claimName": "traefik-acme"
#       }
#     }
#   }
# ]'
#
# ‚úÖ EMAIL –±–µ—Ä—ë—Ç—Å—è –∏–∑ Kubernetes Secret (–±–µ–∑–æ–ø–∞—Å–Ω–æ –¥–ª—è Git)
# ‚úÖ –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ PVC (–ø–µ—Ä–µ–∂–∏–≤—É—Ç –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫)
# ‚úÖ HTTP Challenge —á–µ—Ä–µ–∑ entrypoint=web (–ø–æ—Ä—Ç 80)

---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: traefik-acme
  namespace: traefik
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 128Mi
  storageClassName: local-path  # K3s –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π StorageClass
