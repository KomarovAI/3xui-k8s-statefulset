schemaVersion: '2.0.0'

fileExistenceTests:
  - name: 'App directory exists'
    path: '/app'
    shouldExist: true
  - name: 'Entrypoint script exists'
    path: '/app/DockerEntrypoint.sh'
    shouldExist: true
    permissions: '-rwxr-xr-x'
  - name: 'Persistent volume directory exists'
    path: '/etc/x-ui'
    shouldExist: true

commandTests:
  - name: 'User x-ui exists'
    command: 'id'
    args: ['-u', 'x-ui']
    expectedOutput: ['2000']
  - name: 'App directory is writable'
    command: 'bash'
    args: ['-c', 'touch /etc/x-ui/testfile && echo $?' ]
    expectedOutput: ['0']
  - name: 'Entrypoint is executable'
    command: 'bash'
    args: ['-c', 'test -x /app/DockerEntrypoint.sh && echo OK' ]
    expectedOutput: ['OK']
  - name: 'Bash version'
    command: 'bash'
    args: ['--version']
    expectedOutput: ['GNU bash, version 5.2.26']

metadataTest:
  user: 'x-ui'
  exposedPorts: ['2053', '2096']
  volumes: ['/etc/x-ui']
  labels:
    - key: 'maintainer'
      value: 'KomarovAI'
